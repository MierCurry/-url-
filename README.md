大家在面试中经常会遇到面试官问浏览器输入url之后按回车发生了什么，这里我给大家整理了一份比较全的知识，希望大家喜欢

## 众所周知当我们想搜索一个网站的时候会往浏览器的搜索输入框中输入url进行搜索，但是在你输入url点回车之后浏览器中发生了什么，干了什么呢？

 1. 首先浏览器会先判断你输入的url是否合法，根据你输入的url判断是把你输入的东西当成url处理还是当成关键字搜索，然后根据你输入的内容自动完成字符编码
 
 2. 在判断完url是否合法之后，会判断你使用的协议是http还是https。（**其中关联的知识点有http协议／https原理**） 
 
 3.  当协议确认后浏览器则会判断该解析后的url是否有命中各种缓存（**浏览器缓存、系统缓存、路由器缓存**等），如果命中缓存就会拿到缓存的数据，如果没有命中缓存则进行下一步请求服务器（注：如果是协商缓存的话也会请求服务器）
 
 4. 在没有命中缓存之后，浏览器会去请求服务器，而在请求服务器的时候，因为我们基本输入的url都是一个类似（www.baidu.com）这样的一个url，这个时候其实服务器是不能识别这样一串的，他能识别的是127.0.0.1这样的一个东西，也就是我们所说的IP地址。所以我们要先向**DNS**服务器发送请求，查到相对应的url对应的**IP**地址
 
 5. 我们在拿到IP地址后，还需要知道对方的端口而在我们拿到服务器的IP地址后我们怎么知道对方的**MAC**地址呢？通常在一个局域网内是很少的，所以我们一般会通过多个机器的中转才能链接到对方，这个时候就需要我们的**ARP**协议了，这个协议可以通过下一中转站的MAC地址得到下下个传输的中转站的MAC
 
 6. 而当我们那到了服务器对应的MAC地址后，我们则会想服务器发送**TCP**连接请求。这个就涉及到大家知道的三次握手了。
 
 7.   当握手成功，则想服务器发送HTTP请求，比如我们输入的url是www.baidu.com，则我们会想百度的服务器发送一个www.baidu.com的页面的一个HTTP请求，服务器接收到我们的请求后就会放回数据给浏览器
 
 8. 浏览器接收到请求后，则会判断该请求是否需要缓存，然后浏览器开始解码，而浏览器拿到HTML代码之后会干什么呢？首先会在内存中开辟一块栈内存，用来给代码的执行提供环境，同时会分配出一个主线程去一行一行的执行代码
 
 9. 而我们的页面一般都会有一些css文件的引入和图片等带src或link的css文件，当浏览器没遇到一个就会开辟一个全新的子线程去加载资源文件，（这个时候就会有**CDN**等知识）同时把这些任务放进任务队列（**QUEUE TASK**）
 
 10. 当主线程自上而下的把代码执行完后会生成一个**DOM树**，当任务队列中的css文件处理完后，会结合所有的css生成一个**CSSOM树**，这个CSS DOM会和DOM树合并出一个**Render Tree**（渲染树），用来渲染页面
 
 11. 之后我们会用Render Tree来计算这些元素在设备视口内的确切位置和大小，也就是**回流**
 
 12. 然后根据Render Tree和回流得到的几何信息得到节点的绝对像素，以及拿到节点的其他属性，这个就是**重绘**
 
 13. 然后将这些像素发送给GPU显示，一般页面渲染的速度是我们用户设置中的如60赫兹等也就是一秒60次（注：如果在**事件循环**中有js未执行完，改到了页面的DOM会触发回流和重绘）  


### 到这里整个页面就完成了，上面主要涉及到的知识点有：

 - DNS, HTTP, HTTPS, TCP/IP, ARP等网络相关的知识
 
 - 浏览器渲染页面机制（DOM Tree, CSSOM Tree, Render Tree, QUEUE TASK, Event Loop, Layout, Painting, Display）

#### 对于上面可做的优化：
 - **HTTP缓存**，**DNS缓存**，**CDN**等
 
 - 减少HTTPq请求的次数和大小，这样QUEUE TASK处理会快，我们页面渲染的就快，主要：**资源合并压缩**（雪碧图，GZIP，合并CSS等文件）、**图片懒加载**（原理：减少线程数）、**音视频走流文件**（m3u8）
 
 - **减少操作DOM**（原理：减少回流重绘）：1.采用vue，react等虚拟DOM、2.分离读写、3.样式集中改变、4.缓存布局信息、5、元素批量修改（文档碎片、模版字符）、6.动画效果应用到position为absolute/fixed元素上、7.css3硬件加速、8.减少使用table／css的javascript表达式
